{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rastreio - {{ atendimento.veiculo.placa }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f6f9; font-family: 'Segoe UI', sans-serif; }
        .timeline { border-left: 3px solid #e9ecef; margin-left: 20px; padding-left: 30px; position: relative; }
        .timeline-item { position: relative; margin-bottom: 30px; }
        .timeline-icon { 
            position: absolute; left: -46px; top: 0; width: 32px; height: 32px; 
            border-radius: 50%; background: #fff; border: 3px solid #e9ecef; 
            display: flex; align-items: center; justify-content: center; z-index: 10;
        }
        .timeline-icon.active { border-color: #198754; background: #198754; color: #fff; }
        .card-status { border-radius: 15px; border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    </style>
</head>
<body>

<div class="container py-5" style="max-width: 600px;">
    
    <div class="text-center mb-4">
        {% if atendimento.despachante.logo %}
            <img src="{{ atendimento.despachante.logo.url }}" alt="Logo" height="60" class="mb-3">
        {% else %}
            <h4 class="fw-bold text-primary">{{ atendimento.despachante.nome_fantasia }}</h4>
        {% endif %}
        <p class="text-muted">Acompanhamento de Processo</p>
    </div>

    <div class="card card-status mb-4">
        <div class="card-body p-4 text-center">
            <h1 class="display-4 fw-bold text-dark mb-0">{{ atendimento.veiculo.placa }}</h1>
            <p class="text-muted text-uppercase mb-3">{{ atendimento.veiculo.modelo }}</p>
            
            <span class="badge rounded-pill bg-{{ cor }} fs-6 px-4 py-2 shadow-sm">
                {{ atendimento.get_status_display }}
            </span>
        </div>
        <div class="progress" style="height: 8px; border-radius: 0 0 15px 15px;">
            <div class="progress-bar bg-{{ cor }} progress-bar-striped" style="width: {{ progresso }}%"></div>
        </div>
    </div>

    {% if atendimento.status == 'PENDENTE' and atendimento.motivo_pendencia %}
    <div class="alert alert-warning border-warning shadow-sm mb-5 d-flex align-items-start">
        <div class="me-3 mt-1">
            <i class="fas fa-exclamation-triangle fa-2x text-warning"></i>
        </div>
        <div>
            <h5 class="fw-bold text-dark mb-1">Atenção Necessária!</h5>
            <p class="mb-0 fs-5 text-dark">{{ atendimento.motivo_pendencia }}</p>
            <small class="text-muted mt-2 d-block">Entre em contato conosco para regularizar.</small>
        </div>
    </div>
    {% endif %}

    <div class="px-3">
        <h6 class="fw-bold text-uppercase text-muted mb-4 ms-2">Linha do Tempo</h6>
        
        <div class="timeline">
            <div class="timeline-item">
                <div class="timeline-icon bg-success border-success text-white">
                    <i class="fas fa-check"></i>
                </div>
                <h6 class="fw-bold text-dark">Processo Iniciado</h6>
                
                <small class="text-muted">{{ atendimento.data_solicitacao|date:"d/m/Y" }}</small>
                
                <p class="small text-muted mt-1">Documentação recebida pelo escritório.</p>
            </div>

            <div class="timeline-item">
                <div class="timeline-icon 
                    {% if atendimento.status == 'PENDENTE' %}
                        bg-warning border-warning text-dark
                    {% elif progresso >= 40 %}
                        bg-success border-success text-white
                    {% endif %}">
                    <i class="fas fa-search"></i>
                </div>
                <h6 class="fw-bold {% if progresso < 40 %}text-muted{% endif %}">Análise e Montagem</h6>
                
                {% if atendimento.status == 'PENDENTE' %}
                    <small class="text-warning fw-bold"><i class="fas fa-pause me-1"></i> Aguardando Resolução</small>
                {% elif progresso >= 40 %}
                    <small class="text-success fw-bold">Concluído</small>
                {% endif %}
            </div>

            <div class="timeline-item">
                <div class="timeline-icon {% if progresso >= 70 %}bg-success border-success text-white{% endif %}">
                    <i class="fas fa-university"></i>
                </div>
                <h6 class="fw-bold {% if progresso < 70 %}text-muted{% endif %}">Protocolado no DETRAN</h6>
                <p class="small text-muted">Aguardando emissão do documento.</p>
            </div>

            <div class="timeline-item">
                <div class="timeline-icon {% if progresso == 100 %}bg-success border-success text-white{% endif %}">
                    <i class="fas fa-flag-checkered"></i>
                </div>
                <h6 class="fw-bold {% if progresso < 100 %}text-muted{% endif %}">Pronto para Entrega</h6>
                {% if progresso == 100 %}
                    <p class="text-success fw-bold mt-2">
                        <i class="fas fa-check-circle me-1"></i> Documento Disponível!
                    </p>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="text-center mt-5 mb-5">
        <a href="https://wa.me/55{{ atendimento.despachante.telefone|cut:' '|cut:'-'|cut:'('|cut:')' }}?text=Olá, verifiquei o status do processo {{ atendimento.veiculo.placa }} e..." 
           class="btn btn-success rounded-pill px-4 py-3 shadow fw-bold">
            <i class="fab fa-whatsapp fa-lg me-2"></i> Falar com Despachante
        </a>
    </div>

</div>

</body>
</html>